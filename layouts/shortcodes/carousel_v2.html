<style>
/* Modernes Karussell-Design */
.modern-carousel-container {
    position: relative;
    max-width: 600px;
    margin: 2rem auto;
    overflow: hidden;
    background: #2b2b2b;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    height: 300px; /* Ändere diese Höhe nach Belieben */
}

.modern-carousel-slides {
    height: 100%;
    display: flex;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.modern-carousel-slide {
    min-width: 100%;
    height: 100%;
    box-sizing: border-box;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    position: relative;
}

.modern-carousel-slide-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
}

/* Neuer Container für Skalierung und Verschiebung */
.img-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: auto;
}

.modern-carousel-slide-content img {
    height: auto;
    width: auto;
    max-width: 100%;
    max-height: 100%;
    display: block;
    object-fit: contain;
    margin: 0;
}

/* Neuer Stil für den absolut positionierten Text */
.carousel-caption {
    position: absolute;
    top: 10px;
    left: 10px;
    margin: 0;
    padding: 5px 10px;
    background-color: rgba(0, 0, 0, 0.5);
    color: #fff;
    border-radius: 4px;
    font-size: 0.9em;
    font-family: var(--mc-body-font);
}

/* Stil der Navigationsbuttons */
.modern-carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    z-index: 10;
    font-size: 2rem;
    padding: 0 15px;
    transition: color 0.2s ease-in-out;
}

.modern-carousel-btn.prev {
    left: 10px;
}

.modern-carousel-btn.next {
    right: 10px;
}

.modern-carousel-btn svg {
    width: 2rem;
    height: 2rem;
    fill: #f0f0f0;
    transition: fill 0.2s ease-in-out;
}

.modern-carousel-btn:hover svg {
    fill: #6cc349;
}

/* Punkte-Navigation */
.carousel-dots-wrapper {
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9;
}

.carousel-dots {
    display: flex;
    justify-content: center;
    gap: 8px;
}

.dot {
    width: 10px;
    height: 10px;
    background-color: #6a6a6a;
    border-radius: 50%;
    cursor: pointer;
    transition: background-color 0.3s;
}

.dot.active {
    background-color: #f0f0f0;
}
</style>

<div class="modern-carousel-container">
    <div class="modern-carousel-slides">
        {{ $globalScale := default "1" (.Get "scale") }}
        
        {{/* Schleife über alle Parameter des Shortcodes (die Item-Definitionen) */}}
        {{ range .Params }}
        {{ $parts := split . "|" }}
        {{ $itemNameOrUrl := index $parts 0 }}
        
        {{ $url := $itemNameOrUrl }}
        {{ $caption := "" }}
        {{ $itemScaleFromData := "" }}

        {{/* NEU: Nachschlagen in data/items.yaml */}}
        {{ $itemData := index $.Site.Data.items $itemNameOrUrl }}
        {{ if $itemData }}
            {{ $itemScaleFromData = $itemData.scale }}

            {{ if $itemData.url }}
                {{ $url = $itemData.url }}
            {{ else if $itemData.items }}
                {{/* Wenn es eine Gruppe ist, nimm das erste Item für die statische Karussell-Ansicht */}}
                {{ $firstItemName := index $itemData.items 0 }}
                {{ $firstItemData := index $.Site.Data.items $firstItemName }}
                {{ if $firstItemData }}{{ $url = $firstItemData.url }}{{ end }}
            {{ end }}
        {{ end }}

        {{/* Parameter |1. Caption| */}}
        {{ if gt (len $parts) 1 }}{{ $caption = index $parts 1 }}{{ end }}
        
        {{/* Parameter |2. Lokale Skalierung| - überschreibt YAML und global */}}
        {{ $localScale := $globalScale }}
        {{ if $itemScaleFromData }}
            {{ $localScale = $itemScaleFromData }}
        {{ end }}
        {{ if gt (len $parts) 2 }}{{ $localScale = index $parts 2 }}{{ end }}
        
        {{/* Parameter |3. X-Offset| */}}
        {{ $xOffset := "0px" }}
        {{ if gt (len $parts) 3 }}{{ $xOffset = index $parts 3 }}{{ end }}
        
        {{/* Parameter |4. Y-Offset| */}}
        {{ $yOffset := "0px" }}
        {{ if gt (len $parts) 4 }}{{ $yOffset = index $parts 4 }}{{ end }}

        <div class="modern-carousel-slide">
            <div class="modern-carousel-slide-content">
                <span class="img-wrapper" style="transform: scale({{ $localScale }}) translate({{ $xOffset }}, {{ $yOffset }});">
                    <img src="{{ $url }}" alt="{{ $caption }}">
                </span>
            </div>
            {{ if $caption }}<p class="carousel-caption">{{ $caption }}</p>{{ end }}
        </div>
        {{ end }}
    </div>
    <button class="modern-carousel-btn prev">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <button class="modern-carousel-btn next">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
    </button>
    <div class="carousel-dots-wrapper">
        <div class="carousel-dots"></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const carouselContainers = document.querySelectorAll('.modern-carousel-container');

    carouselContainers.forEach(container => {
        const carouselSlides = container.querySelector('.modern-carousel-slides');
        const slides = container.querySelectorAll('.modern-carousel-slide');
        const prevBtn = container.querySelector('.modern-carousel-btn.prev');
        const nextBtn = container.querySelector('.modern-carousel-btn.next');
        const dotsContainer = container.querySelector('.carousel-dots');

        if (slides.length <= 1) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            dotsContainer.style.display = 'none';
            return;
        }

        let currentIndex = 0;
        const totalSlides = slides.length;

        const updateCarousel = () => {
            carouselSlides.style.transform = `translateX(${-currentIndex * 100}%)`;
            updateDots();
        };

        const updateDots = () => {
            dotsContainer.innerHTML = '';
            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('div');
                dot.classList.add('dot');
                if (i === currentIndex) {
                    dot.classList.add('active');
                }
                dot.addEventListener('click', () => {
                    currentIndex = i;
                    updateCarousel();
                });
                dotsContainer.appendChild(dot);
            }
        };

        prevBtn.addEventListener('click', () => {
            currentIndex = (currentIndex > 0) ? currentIndex - 1 : totalSlides - 1;
            updateCarousel();
        });

        nextBtn.addEventListener('click', () => {
            currentIndex = (currentIndex < totalSlides - 1) ? currentIndex + 1 : 0;
            updateCarousel();
        });

        // Initialisierung
        updateCarousel();
    });
});
</script>